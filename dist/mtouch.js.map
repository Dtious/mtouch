{"version":3,"file":"mtouch.js","sources":["../src/utils.js","../src/handlerBus.js","../src/index.js"],"sourcesContent":["export default {\n    getLength(v1) {\n        if (typeof v1 !== 'object') {\n            console.error('getLength error!');\n            return;\n        }\n        return Math.sqrt(v1.x * v1.x + v1.y * v1.y);\n    },\n    getAngle(v1, v2) {\n        if (typeof v1 !== 'object' || typeof v2 !== 'object') {\n            console.error('getAngle error!');\n            return;\n        }\n        // 判断方向，顺时针为 1 ,逆时针为 -1；\n        let direction = v1.x * v2.y - v2.x * v1.y > 0 ? 1: -1,\n            // 两个向量的模；\n            len1 = this.getLength(v1),\n            len2 = this.getLength(v2),\n            mr = len1 * len2,\n            dot,r;\n        if (mr === 0)return 0;\n        // 通过数量积公式可以推导出：\n        // cos = (x1 * x2 + y1 * y2)/(|a| * |b|);\n        dot = v1.x * v2.x + v1.y * v2.y;\n        r = dot / mr;\n        if (r > 1)r = 1;\n        if (r < -1)r = -1;\n        // 解值并结合方向转化为角度值；\n        return Math.acos(r) * direction * 180 / Math.PI;\n    },\n    getBasePoint(el) {\n        if (!el) return {x:0,y:0};\n        let offset = this.getOffset(el);\n        let x = offset.left + el.getBoundingClientRect().width / 2,\n            y = offset.top + el.getBoundingClientRect().width / 2;\n        return {x: Math.round(x), y: Math.round(y)};\n    },\n    extend(obj1, obj2) {\n        for (let k in obj2) {\n            if (obj2.hasOwnProperty(k)) {\n                if(typeof obj2[k] == 'object' && !(obj2[k] instanceof Node)){\n                    if(typeof obj1[k] !== 'object'){\n                        obj1[k] = {};\n                    }\n                    this.extend(obj1[k],obj2[k]);\n                }else{\n                    obj1[k] = obj2[k];\n                }\n            }\n        }\n        return obj1;\n    },\n    getVector(p1, p2) {\n        if (typeof p1 !== 'object' || typeof p2 !== 'object' ) {\n            console.error('getvector error!');\n            return;\n        }\n        let x = Math.round(p1.x - p2.x),\n            y = Math.round(p1.y - p2.y);\n        return { x, y };\n    },\n    getPoint(ev, index) {\n        if (!ev || !ev.touches[index]) {\n            console.error('getPoint error!');\n            return;\n        }\n        return {\n            x: Math.round(ev.touches[index].pageX),\n            y: Math.round(ev.touches[index].pageY),\n        };\n    },\n    getOffset(el){\n        el = typeof el == 'string'? document.querySelector(el): el;\n        let rect = el.getBoundingClientRect();\n        let offset = {\n            left:rect.left + document.body.scrollLeft,\n            top:rect.top + document.body.scrollTop,\n            width:el.offsetWidth,\n            height:el.offsetHeight,\n        };\n        return offset;\n    },\n    matrixTo(matrix){\n        let arr = (matrix.replace('matrix(','').replace(')','')).split(',');\n        let cos = arr[0],\n            sin = arr[1],\n            tan = sin / cos,\n            rotate = Math.atan( tan ) * 180 / Math.PI,\n            scale = cos / ( Math.cos( Math.PI / 180 * rotate )),\n            trans;\n        trans = {\n            x:parseInt(arr[4]),\n            y:parseInt(arr[5]),\n            scale,\n            rotate,\n        };\n        return trans;\n    },\n    getUseName(evName){\n        let useName = evName.replace('start','');\n        let end = useName.indexOf('rotate') !== -1 ? 'nd' : 'end';\n        useName = useName.replace(end,'');\n        return useName;\n    },\n    domify(DOMString) {\n        let htmlDoc = document.implementation.createHTMLDocument();\n        htmlDoc.body.innerHTML = DOMString;\n        return htmlDoc.body.children;\n    },\n    getEl(el){\n        if(!el){\n            console.error('el error,there must be a el!');\n            return;\n        }\n        let _el;\n        if(typeof el == 'string'){\n            _el = document.querySelector(el);\n        }else if(el instanceof Node){\n            _el = el;\n        }else{\n            console.error('el error,there must be a el!');\n            return;\n        }\n        return _el;\n    },\n    data(el,key){\n        el = this.getEl(el);\n        return el.getAttribute(`data-${key}`);\n    },\n    include(str1,str2){\n        if(str1.indexOf){\n            return str1.indexOf(str2) !== -1;\n        }else{\n            return false;\n        }\n    },\n    getPos(el) {\n        if(!el)return;\n        el = this.getEl(el);\n        let defaulTrans;\n        let style = window.getComputedStyle(el,null);\n        let cssTrans = style.transform || style.webkitTransform;\n\n        if(window.getComputedStyle && cssTrans !== 'none'){\n            defaulTrans = this.matrixTo(cssTrans);\n        }else{\n            defaulTrans = {\n                x: 0,\n                y: 0,\n                scale: 1,\n                rotate: 0,\n            };\n        }\n        return JSON.parse(el.getAttribute('data-mtouch-status')) || defaulTrans;\n    },\n};\n","export default class HandlerBus{\n    constructor(el) {\n        this.handlers = [];\n        this.el = el;\n    }\n    add(handler){\n        this.handlers.push(handler);\n        return this;\n    }\n    del(handler){\n        if(!handler){\n            this.handlers = [];\n        }else{\n            this.handlers.forEach((value,index)=>{\n                if(value === handler){\n                    this.handlers.splice(index,1);\n                }\n            });\n        }\n        return this;\n    }\n    fire(){\n        if(!this.handlers || !this.handlers.length === 0)return;\n        this.handlers.forEach(handler=>{\n            if(typeof handler === 'function') handler.apply(this.el, arguments);\n        });\n        return this;\n    }\n}\n","import _ from './utils';\nimport HandlerBus from './handlerBus';\n\nconst EVENT = ['touchstart','touchmove','touchend','drag','dragstart','dragend','pinch','pinchstart','pinchend','rotate','rotatestart','rotatend','singlePinchstart','singlePinch','singlePinchend','singleRotate','singleRotatestart','singleRotatend'];\n\nconst ORIGINEVENT = ['touchstart', 'touchmove', 'touchend', 'touchcancel'];\n\nexport default function MTouch(el = '') {\n    // 兼容不使用 new 的方式；\n    if (!(this instanceof MTouch))return new MTouch(el);\n    // 开关；\n    // 初始化时关闭，在调用 on 函数时对应开启；\n    this.use = {\n        drag: false,\n        pinch: false,\n        rotate: false,\n        singlePinch: false,\n        singleRotate: false,\n    };\n    // 获取容器元素；\n    this.operator = this.el = _.getEl(el);\n    // 状态记录；\n    this.draging = this.pinching = this.rotating = this.singlePinching = this.singleRotating = false;\n    // 全局参数记录；\n    this.fingers = 0;\n    this.startScale = 1;\n    this.startPoint = {};\n    this.secondPoint = {};\n    this.pinchStartLength = null;\n    this.singlePinchStartLength = null;\n    this.vector1 = {};\n    this.singleBasePoint = {};\n\n    // 初始化注册事件队列；\n    this._driveBus();\n    // 监听原生 touch 事件；\n    this._bind();\n}\n\nMTouch.prototype._driveBus = function() {\n    EVENT.forEach(evName => {\n        this[evName] = new HandlerBus(this.el);\n    });\n};\n\nMTouch.prototype._bind = function() {\n    ORIGINEVENT.forEach(evName => {\n        let fn = evName == 'touchcancel'? 'end': evName.replace('touch', '');\n        // 需要存下 bind(this) 后的函数指向，用于 destroy;\n        this[`_${fn}_bind`] = this[`_${fn}`].bind(this);\n        this.el.addEventListener(evName, this[`_${fn}_bind`], false);\n    });\n};\nMTouch.prototype.destroy = function() {\n    ORIGINEVENT.forEach(evName => {\n        let fn = evName == 'touchcancel' ? 'end' : evName.replace('touch', '');\n        this.el.removeEventListener(evName, this[`_${fn}_bind`], false);\n    });\n};\nMTouch.prototype._start = function(e) {\n    if (!e.touches || e.type !== 'touchstart')return;\n    // 记录手指数量；\n    this.fingers = e.touches.length;\n    // 记录第一触控点；\n    this.startPoint = _.getPoint(e, 0);\n    // 计算单指操作时的基础点；\n    this.singleBasePoint = _.getBasePoint(this.operator);\n    // 双指操作时\n    if (this.fingers > 1) {\n        // 第二触控点；\n        this.secondPoint = _.getPoint(e, 1);\n        // 计算双指向量；\n        this.vector1 = _.getVector(this.secondPoint, this.startPoint);\n        // 计算向量模；\n        this.pinchStartLength = _.getLength(this.vector1);\n    } else if (this.use.singlePinch) {\n        // 单指且监听 singlePinch 时，计算向量模；\n        let pinchV1 = _.getVector(this.startPoint, this.singleBasePoint);\n        this.singlePinchStartLength = _.getLength(pinchV1);\n    }\n    // 触发 touchstart 事件；\n    this.touchstart.fire({origin: e, eventType: 'touchstart'});\n};\nMTouch.prototype._move = function(ev) {\n    if (!ev.touches || ev.type !== 'touchmove')return;\n    // 判断触控点是否为 singlebutton 区域；\n    let isSingleButton = _.data(ev.target,'singleButton'),\n        curFingers = ev.touches.length,\n        curPoint = _.getPoint(ev, 0),\n        singlePinchLength,\n        pinchLength,\n        rotateV1,\n        rotateV2,\n        pinchV2;\n    // 当从原先的两指到一指的时候，可能会出现基础手指的变化，导致跳动；\n    // 因此需屏蔽掉一次错误的touchmove事件，待重新设置基础指后，再继续进行；\n    if (curFingers < this.fingers) {\n        this.startPoint = curPoint;\n        this.fingers = curFingers;\n        return;\n    }\n    // 两指先后触摸时，只会触发第一指一次 touchstart，第二指不会再次触发 touchstart；\n    // 因此会出现没有记录第二指状态，需要在touchmove中重新获取参数；\n    if (curFingers > 1 && (!this.secondPoint || !this.vector1 || !this.pinchStartLength)) {\n        this.secondPoint = _.getPoint(ev, 1);\n        this.vector1 = _.getVector(this.secondPoint, this.startPoint);\n        this.pinchStartLength = _.getLength(this.vector1);\n    }\n    // 双指时，需触发 pinch 和 rotate 事件；\n    if (curFingers > 1) {\n        let curSecPoint = _.getPoint(ev, 1),\n            vector2 = _.getVector(curSecPoint, curPoint);\n        // 触发 pinch 事件；\n        if (this.use.pinch) {\n            pinchLength = _.getLength(vector2);\n            this._eventFire('pinch', {\n                delta: {\n                    scale: pinchLength / this.pinchStartLength,\n                },\n                origin: ev,\n            });\n            this.pinchStartLength = pinchLength;\n        }\n        // 触发 rotate 事件；\n        if (this.use.rotate) {\n            this._eventFire('rotate', {\n                delta: {\n                    rotate: _.getAngle(this.vector1, vector2),\n                },\n                origin: ev,\n            });\n            this.vector1 = vector2;\n        }\n    } else {\n        // 触发 singlePinch 事件;\n        if (this.use.singlePinch && isSingleButton) {\n            pinchV2 = _.getVector(curPoint, this.singleBasePoint);\n            singlePinchLength = _.getLength(pinchV2);\n            this._eventFire('singlePinch', {\n                delta: {\n                    scale: singlePinchLength / this.singlePinchStartLength,\n                },\n                origin: ev,\n            });\n            this.singlePinchStartLength = singlePinchLength;\n        }\n        // 触发 singleRotate 事件;\n        if (this.use.singleRotate && isSingleButton) {\n            rotateV1 = _.getVector(this.startPoint, this.singleBasePoint);\n            rotateV2 = _.getVector(curPoint, this.singleBasePoint);\n            this._eventFire('singleRotate', {\n                delta: {\n                    rotate: _.getAngle(rotateV1, rotateV2),\n                },\n                origin: ev,\n            });\n        }\n    }\n    // 触发 drag 事件；\n    if (this.use.drag) {\n        if (!isSingleButton) {\n            this._eventFire('drag', {\n                delta: {\n                    deltaX: curPoint.x - this.startPoint.x,\n                    deltaY: curPoint.y - this.startPoint.y,\n                },\n                origin: ev,\n            });\n        }\n    }\n    this.startPoint = curPoint;\n    // 触发 touchmove 事件；\n    this.touchmove.fire({eventType: 'touchmove', origin: ev});\n    ev.preventDefault();\n};\nMTouch.prototype._end = function(ev) {\n    if (!ev.touches && ev.type !== 'touchend' && ev.type !== 'touchcancel')return;\n    // 触发 end 事件；\n    ['pinch', 'drag', 'rotate', 'singleRotate', 'singlePinch'].forEach(evName => {\n        this._eventEnd(evName, {origin: ev});\n    });\n    this.touchend.fire({eventType: 'touchend', origin: ev});\n};\nMTouch.prototype._eventFire = function(evName, ev) {\n    let ing = `${evName}ing`,\n        start = `${evName}start`;\n    if (!this[ing]) {\n        ev.eventType = start;\n        this[start].fire(ev);\n        this[ing] = true;\n    } else {\n        ev.eventType = evName;\n        this[evName].fire(ev);\n    }\n};\nMTouch.prototype._eventEnd = function(evName, ev) {\n    let ing = `${evName}ing`,\n        end;\n    if (evName == 'rotate' || evName == 'singleRotate') {\n        end = `${evName}nd`;\n    } else {\n        end = `${evName}end`;\n    }\n    if (this[ing]) {\n        ev.eventType = end;\n        this[end].fire(ev);\n        this[ing] = false;\n    }\n};\n// 添加 button 区域；\n// 背景样式由业务方定制；\nMTouch.prototype._addButton = function(el){\n    let [button] = _.domify(`<div class=\"mtouch-singleButton\" data-singleButton='true' style='position:absolute;right:-15px;bottom: -15px;width:30px;height: 30px;background-size: 100% 100%;'></div>`),\n        _style;\n    el.appendChild(button);\n    el.setAttribute('data-mtouch-addButton',true);\n    if(getComputedStyle && window.getComputedStyle(el,null).position === 'static'){\n        _style = el.style || '';\n        el.style = _style + 'position:relative';\n    }\n};\n// 切换 operator;\nMTouch.prototype.switch = function(el,addButton = true) {\n    let _el;\n    if(!el){\n        this.operator = this.el;\n        return;\n    }\n    this.operator = _el = _.getEl(el);\n    if(!_.data(_el,'mtouch-addButton') && (this.use.singleRotate || this.use.singlePinch) && addButton){\n        this._addButton(_el);\n    }\n};\nMTouch.prototype.on = function(evName, handler = ()=>{}, operator) {\n    if(_.include(evName,' ')){\n        evName.split(' ').forEach(v=>{\n            this._on(v,handler,operator);\n        });\n    }else{\n        this._on(evName,handler,operator);\n    }\n    return this;\n};\nMTouch.prototype._on = function(evName,handler,operator){\n    this.use[_.getUseName(evName)] = true;\n    this[evName].add(handler);\n    this.switch(operator);\n};\nMTouch.prototype.off = function(evName, handler) {\n    this[evName].del(handler);\n};\n"],"names":["v1","error","Math","sqrt","x","y","v2","direction","getLength","len2","mr","len1","dot","r","acos","PI","el","offset","getOffset","left","getBoundingClientRect","width","top","round","obj1","obj2","k","hasOwnProperty","Node","extend","p1","p2","ev","index","touches","pageX","pageY","document","querySelector","rect","body","scrollLeft","scrollTop","offsetWidth","offsetHeight","matrix","arr","replace","split","cos","sin","tan","rotate","atan","scale","trans","parseInt","evName","useName","end","indexOf","DOMString","htmlDoc","implementation","createHTMLDocument","innerHTML","children","_el","key","getEl","getAttribute","str1","str2","defaulTrans","style","window","getComputedStyle","cssTrans","transform","webkitTransform","matrixTo","JSON","parse","HandlerBus","handlers","handler","push","forEach","value","splice","length","apply","EVENT","ORIGINEVENT","MTouch","use","operator","_","draging","pinching","rotating","singlePinching","singleRotating","fingers","startScale","startPoint","secondPoint","pinchStartLength","singlePinchStartLength","vector1","singleBasePoint","_driveBus","_bind","prototype","fn","bind","addEventListener","destroy","removeEventListener","_start","e","type","getPoint","getBasePoint","getVector","singlePinch","pinchV1","touchstart","fire","origin","eventType","_move","isSingleButton","data","target","curFingers","curPoint","singlePinchLength","pinchLength","rotateV1","rotateV2","pinchV2","curSecPoint","vector2","pinch","_eventFire","getAngle","singleRotate","drag","touchmove","preventDefault","_end","_eventEnd","touchend","ing","start","_addButton","domify","button","_style","appendChild","setAttribute","position","switch","addButton","on","include","_on","v","getUseName","add","off","del"],"mappings":"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"}