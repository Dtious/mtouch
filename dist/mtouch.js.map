{"version":3,"file":"mtouch.js","sources":["../src/utils.js","../src/handlerBus.js","../src/index.js"],"sourcesContent":["export default {\n    getLength(v1) {\n        if (typeof v1 !== 'object') {\n            console.error('getLength error!');\n            return;\n        }\n        return Math.sqrt(v1.x * v1.x + v1.y * v1.y);\n    },\n    getAngle(v1, v2) {\n        if (typeof v1 !== 'object' || typeof v2 !== 'object') {\n            console.error('getAngle error!');\n            return;\n        }\n        let direction = v1.x * v2.y - v2.x * v1.y > 0 ? 1: -1,\n            len1 = this.getLength(v1),\n            len2 = this.getLength(v2),\n            mr = len1 * len2,\n            dot,r;\n        if (mr === 0)return 0;\n        dot = v1.x * v2.x + v1.y * v2.y;\n        r = dot / mr;\n        if (r > 1)r = 1;\n        if (r < -1)r = -1;\n        return Math.acos(r) * direction * 180 / Math.PI;\n    },\n    getBasePoint(el) {\n        if (!el) return {x:0,y:0};\n        let offset = this.getOffset(el);\n        let x = offset.left + el.getBoundingClientRect().width / 2,\n            y = offset.top + el.getBoundingClientRect().width / 2;\n        return {x: Math.round(x), y: Math.round(y)};\n    },\n    // setPos(el, transform) {\n    //     let str = JSON.stringify(transform);\n    //     let value = `translate3d(${transform.x}px,${transform.y}px,0px) scale(${transform.scale}) rotate(${transform.rotate}deg)`;\n    //     el = typeof el == 'string'? document.querySelector(el): el;\n    //     el.style.transform = value;\n    //     el.setAttribute('data-mtouch-status', str);\n    // },\n    // getPos(el) {\n    //     let defaulTrans;\n    //     let cssTrans = window.getComputedStyle(el,null).transform;\n    //     if(window.getComputedStyle && cssTrans !== 'none'){\n    //         defaulTrans = this.matrixTo(cssTrans);\n    //     }else{\n    //         defaulTrans = {\n    //             x: 0,\n    //             y: 0,\n    //             scale: 1,\n    //             rotate: 0,\n    //         };\n    //     }\n    //     return JSON.parse(el.getAttribute('data-mtouch-status')) || defaulTrans;\n    // },\n    extend(obj1, obj2) {\n        for (let k in obj2) {\n            if (obj2.hasOwnProperty(k)) {\n                if(typeof obj2[k] == 'object'){\n                    if(typeof obj1[k] !== 'object'){\n                        obj1[k] = {};\n                    }\n                    this.extend(obj1[k],obj2[k]);\n                }else{\n                    obj1[k] = obj2[k];\n                }\n            }\n        }\n        return obj1;\n    },\n    getVector(p1, p2) {\n        if (typeof p1 !== 'object' || typeof p2 !== 'object' ) {\n            console.error('getvector error!');\n            return;\n        }\n        let x = Math.round(p1.x - p2.x),\n            y = Math.round(p1.y - p2.y);\n        return { x, y };\n    },\n    getPoint(ev, index) {\n        if (!ev || !ev.touches[index]) {\n            console.error('getPoint error!');\n            return;\n        }\n        return {\n            x: Math.round(ev.touches[index].pageX),\n            y: Math.round(ev.touches[index].pageY),\n        };\n    },\n    getOffset(el){\n        el = typeof el == 'string'? document.querySelector(el): el;\n        let rect = el.getBoundingClientRect();\n        let offset = {\n            left:rect.left + document.body.scrollLeft,\n            top:rect.top + document.body.scrollTop,\n            width:el.offsetWidth,\n            height:el.offsetHeight,\n        };\n        return offset;\n    },\n    matrixTo(matrix){\n        let arr = (matrix.replace('matrix(','').replace(')','')).split(',');\n        let cos = arr[0],\n            sin = arr[1],\n            tan = sin / cos,\n            rotate = Math.atan( tan ) * 180 / Math.PI,\n            scale = cos / ( Math.cos( Math.PI / 180 * rotate )),\n            trans;\n        trans = {\n            x:parseInt(arr[4]),\n            y:parseInt(arr[5]),\n            scale,\n            rotate,\n        };\n        return trans;\n    },\n    getUseName(evName){\n        let useName = evName.replace('start','');\n        let end = useName.indexOf('rotate') !== -1 ? 'nd' : 'end';\n        useName = useName.replace(end,'');\n        return useName;\n    },\n};\n","export default class HandlerBus{\n    constructor(el) {\n        this.handlers = [];\n        this.el = el;\n    }\n    add(handler){\n        this.handlers.push(handler);\n        return this;\n    }\n    del(handler){\n        if(!handler){\n            this.handlers = [];\n        }else{\n            this.handlers.forEach((value,index)=>{\n                if(value === handler){\n                    this.handlers.splice(index,1);\n                }\n            });\n        }\n        return this;\n    }\n    fire(){\n        if(!this.handlers || !this.handlers.length === 0)return;\n        this.handlers.forEach(handler=>{\n            if(typeof handler === 'function') handler.apply(this.el, arguments);\n        });\n        return this;\n    }\n}\n","import _ from './utils';\nimport HandlerBus from './handlerBus';\n\nconst EVENT = ['touchstart','touchmove','touchend','drag','dragstart','dragend','pinch','pinchstart','pinchend','rotate','rotatestart','rotatend'];\n\nconst ORIGINEVENT = ['touchstart', 'touchmove', 'touchend', 'touchcancel'];\n\nexport default function MTouch(config, operator) {\n\n    // 兼容不使用 new 的方式；\n    if (!(this instanceof MTouch))\n        return new MTouch(config, operator);\n\n    // options 多态；\n    let options;\n    if (typeof config === 'string') {\n        options = {};\n        options.receiver = config;\n        if (operator) {\n            options.operator = operator;\n        }\n    } else if (typeof config === 'object') {\n        options = config;\n    }\n\n    this.ops = {\n        // config:\n        receiver: null,\n        operator: null,\n\n        // event\n        touchstart() {},\n        touchmove() {},\n        touchend() {},\n\n        drag() {},\n        dragstart() {},\n        dragend() {},\n\n        pinch() {},\n        pinchstart() {},\n        pinchend() {},\n\n        rotate() {},\n        rotatestart() {},\n        rotatend() {},\n\n        singlePinch: {\n            start() {},\n            pinch() {},\n            end() {},\n            buttonId: null,\n        },\n\n        singleRotate: {\n            start() {},\n            rotate() {},\n            end() {},\n            buttonId: null,\n        },\n    };\n\n    // 开关；\n    this.use = {\n        drag: !!options.drag || !!options.dragstart || !!options.dragend,\n        pinch: !!options.pinch || !!options.pinchstart || !!options.pinchend,\n        rotate: !!options.rotate || !!options.rotatestart || !!options.rotateend,\n        singlePinch: !!options.singlePinch && !!options.singlePinch.buttonId,\n        singleRotate: !!options.singleRotate && !!options.singleRotate.buttonId,\n    };\n\n    this.ops = _.extend(this.ops, options);\n\n    // receiver test;\n    if (!this.ops.receiver || typeof this.ops.receiver !== 'string') {\n        console.error('receiver error,there must be a receiver-selector');\n        return;\n    }\n    // 事件接收器；\n    this.receiver = document.querySelector(this.ops.receiver);\n\n    // 事件操纵器；\n    if (this.ops.operator) {\n        if (typeof this.ops.operator !== 'string') {\n            console.error('operator error, the operator param must be a selector');\n            return;\n        }\n        this.operator = document.querySelector(this.ops.operator);\n    } else {\n        if(this.ops.operator === ''){\n            this.operator = null;\n        }else{\n            this.operator = this.receiver;\n        }\n    }\n    // touch状态；\n    this.fingers = 0;\n    // 初始状态;\n    this.draging = this.pinching = this.rotating = this.singleRotating = this.singlePinching = false;\n\n    this.startScale = 1;\n    this.startPoint = {};\n    this.secondPoint = {};\n    this.pinchStartLength = null;\n    this.singlePinchStartLength = null;\n    this.vector1 = {};\n    this.singleBasePoint = {};\n    // eventbus\n    this.driveBus();\n    this.bind();\n}\n\nMTouch.prototype.driveBus = function() {\n    EVENT.forEach(eventName => {\n        this[eventName] = new HandlerBus(this.receiver).add(this.ops[eventName] || function() {});\n    });\n    this.singlePinchstart = new HandlerBus(this.receiver).add(this.ops.singlePinch.start || function() {});\n    this.singlePinch = new HandlerBus(this.receiver).add(this.ops.singlePinch.pinch || function() {});\n    this.singlePinchend = new HandlerBus(this.receiver).add(this.ops.singlePinch.end || function() {});\n    this.singleRotatestart = new HandlerBus(this.receiver).add(this.ops.singleRotate.start || function() {});\n    this.singleRotate = new HandlerBus(this.receiver).add(this.ops.singleRotate.rotate || function() {});\n    this.singleRotatend = new HandlerBus(this.receiver).add(this.ops.singleRotate.end || function() {});\n};\n\nMTouch.prototype.bind = function() {\n    ORIGINEVENT.forEach(evName => {\n        let fn = evName == 'touchcancel'? 'end': evName.replace('touch', '');\n        // 需要存下 bind(this) 后的函数指向，用于 destroy;\n        this[fn + '_bind'] = this[fn].bind(this);\n        this.receiver.addEventListener(evName, this[fn + '_bind'], false);\n    });\n};\nMTouch.prototype.destroy = function() {\n    ORIGINEVENT.forEach(evName => {\n        let fn = evName == 'touchcancel'\n            ? 'end'\n            : evName.replace('touch', '');\n        this.receiver.removeEventListener(evName, this[fn + '_bind'], false);\n    });\n};\nMTouch.prototype.start = function(ev) {\n    if (!ev.touches || ev.type !== 'touchstart')return;\n\n    this.fingers = ev.touches.length;\n    this.startPoint = _.getPoint(ev, 0);\n    this.singleBasePoint = _.getBasePoint(this.operator);\n\n    if (this.fingers > 1) {\n        this.secondPoint = _.getPoint(ev, 1);\n        this.vector1 = _.getVector(this.secondPoint, this.startPoint);\n        this.pinchStartLength = _.getLength(this.vector1);\n    } else if (this.use.singlePinch && this.operator) {\n        let pinchV1 = _.getVector(this.startPoint, this.singleBasePoint);\n        this.singlePinchStartLength = _.getLength(pinchV1);\n    }\n\n    this.touchstart.fire({origin: ev, eventType: 'touchstart'});\n};\nMTouch.prototype.move = function(ev) {\n    if (!ev.touches || ev.type !== 'touchmove')return;\n    let curPoint = _.getPoint(ev, 0),\n        curFingers = ev.touches.length,\n        rotateV1,\n        rotateV2,\n        pinchV2,\n        pinchLength,\n        singlePinchLength;\n\n    // 当从原先的两指到一指的时候，可能会出现基础手指的变化，导致跳动；\n    // 因此需屏蔽掉一次错误的touchmove事件，待重新设置基础指后，再继续进行；\n    if (curFingers < this.fingers) {\n        this.startPoint = curPoint;\n        this.fingers = curFingers;\n        return;\n    }\n\n    // 两指先后触摸时，只会触发第一指一次touchstart，第二指不会再次触发touchstart；\n    // 因此会出现没有记录第二指状态，需要在touchmove中重新获取参数；\n    if (curFingers > 1 && (!this.secondPoint || !this.vector1 || !this.pinchStartLength)) {\n        this.secondPoint = _.getPoint(ev, 1);\n        this.vector1 = _.getVector(this.secondPoint, this.startPoint);\n        this.pinchStartLength = _.getLength(this.vector1);\n    }\n\n    // 双指时，需触发pinch和rotate事件；\n    if (curFingers > 1) {\n        let curSecPoint = _.getPoint(ev, 1),\n            vector2 = _.getVector(curSecPoint, curPoint);\n        // pinch\n        if (this.use.pinch) {\n            pinchLength = _.getLength(vector2);\n            this.eventFire('pinch', {\n                delta: {\n                    scale: pinchLength / this.pinchStartLength,\n                },\n                origin: ev,\n            });\n            this.pinchStartLength = pinchLength;\n        }\n        // rotate\n        if (this.use.rotate) {\n            this.eventFire('rotate', {\n                delta: {\n                    rotate: _.getAngle(this.vector1, vector2),\n                },\n                origin: ev,\n            });\n            this.vector1 = vector2;\n        }\n    } else {\n        // singlePinch;\n        if (this.use.singlePinch && ev.target.id == this.ops.singlePinch.buttonId && this.operator) {\n            pinchV2 = _.getVector(curPoint, this.singleBasePoint);\n            singlePinchLength = _.getLength(pinchV2);\n            this.eventFire('singlePinch', {\n                delta: {\n                    scale: singlePinchLength / this.singlePinchStartLength,\n                },\n                origin: ev,\n            });\n            this.singlePinchStartLength = singlePinchLength;\n        }\n        // singleRotate;\n        if (this.use.singleRotate && ev.target.id == this.ops.singleRotate.buttonId  && this.operator) {\n            rotateV1 = _.getVector(this.startPoint, this.singleBasePoint);\n            rotateV2 = _.getVector(curPoint, this.singleBasePoint);\n            this.eventFire('singleRotate', {\n                delta: {\n                    rotate: _.getAngle(rotateV1, rotateV2),\n                },\n                origin: ev,\n            });\n        }\n    }\n    if (this.use.drag) {\n        if (ev.target.id !== this.ops.singlePinch.buttonId && ev.target.id !== this.ops.singleRotate.buttonId) {\n            this.eventFire('drag', {\n                delta: {\n                    deltaX: curPoint.x - this.startPoint.x,\n                    deltaY: curPoint.y - this.startPoint.y,\n                },\n                origin: ev,\n            });\n        }\n    }\n    this.startPoint = curPoint;\n    this.touchmove.fire({eventType: 'touchmove', origin: ev});\n    ev.preventDefault();\n};\nMTouch.prototype.end = function(ev) {\n    if (!ev.touches && ev.type !== 'touchend' && ev.type !== 'touchcancel')return;\n    ['pinch', 'drag', 'rotate', 'singleRotate', 'singlePinch'].forEach(evName => {\n        this.eventEnd(evName, {origin: ev});\n    });\n    this.touchend.fire({eventType: 'touchend', origin: ev});\n};\nMTouch.prototype.eventFire = function(evName, ev) {\n    let ing = `${evName}ing`;\n    let start = `${evName}start`;\n    if (!this[ing]) {\n        ev.eventType = start;\n        this[start].fire(ev);\n        this[ing] = true;\n    } else {\n        ev.eventType = evName;\n        this[evName].fire(ev);\n    }\n};\nMTouch.prototype.eventEnd = function(evName, ev) {\n    let ing = `${evName}ing`,\n        end;\n    if (evName == 'rotate' || evName == 'singleRotate') {\n        end = `${evName}nd`;\n    } else {\n        end = `${evName}end`;\n    }\n    if (this[ing]) {\n        ev.eventType = end;\n        this[end].fire(ev);\n        this[ing] = false;\n    }\n};\nMTouch.prototype.switchOperator = function(el) {\n    this.operator = el;\n};\nMTouch.prototype.on = function(evName, handler) {\n    this.use[_.getUseName(evName)] = true;\n    this[evName].add(handler);\n};\nMTouch.prototype.off = function(evName, handler) {\n    this[evName].del(handler);\n};\n"],"names":["v1","error","Math","sqrt","x","y","v2","direction","len1","getLength","len2","mr","dot","r","acos","PI","el","offset","getOffset","left","getBoundingClientRect","width","top","round","obj1","obj2","k","hasOwnProperty","_typeof","extend","p1","p2","ev","index","touches","pageX","pageY","document","querySelector","rect","body","scrollLeft","scrollTop","offsetWidth","offsetHeight","matrix","arr","replace","split","cos","sin","tan","rotate","atan","scale","trans","parseInt","evName","useName","end","indexOf","HandlerBus","handlers","handler","push","forEach","value","splice","length","apply","EVENT","ORIGINEVENT","MTouch","config","operator","options","receiver","ops","use","drag","dragstart","dragend","pinch","pinchstart","pinchend","rotatestart","rotateend","singlePinch","buttonId","singleRotate","_","fingers","draging","pinching","rotating","singleRotating","singlePinching","startScale","startPoint","secondPoint","pinchStartLength","singlePinchStartLength","vector1","singleBasePoint","driveBus","bind","prototype","eventName","add","singlePinchstart","start","singlePinchend","singleRotatestart","singleRotatend","fn","addEventListener","destroy","removeEventListener","type","getPoint","getBasePoint","getVector","pinchV1","touchstart","fire","origin","eventType","move","curPoint","curFingers","rotateV1","rotateV2","pinchV2","pinchLength","singlePinchLength","curSecPoint","vector2","eventFire","getAngle","target","id","touchmove","preventDefault","eventEnd","touchend","ing","switchOperator","on","getUseName","off","del"],"mappings":"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"}