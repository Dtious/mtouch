!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.MTouch=e()}(this,function(){"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!(this instanceof e))return new e(t);this.use={drag:!1,pinch:!1,rotate:!1,singlePinch:!1,singleRotate:!1},this.operator=this.el=i.getEl(t),this.draging=this.pinching=this.rotating=this.singlePinching=this.singleRotating=!1,this.fingers=0,this.startScale=1,this.startPoint={},this.secondPoint={},this.pinchStartLength=null,this.singlePinchStartLength=null,this.vector1={},this.singleBasePoint={},this._driveBus(),this._bind()}var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i={getLength:function(t){return"object"!==(void 0===t?"undefined":n(t))?void console.error("getLength error!"):Math.sqrt(t.x*t.x+t.y*t.y)},getAngle:function(t,e){if("object"!==(void 0===t?"undefined":n(t))||"object"!==(void 0===e?"undefined":n(e)))return void console.error("getAngle error!");var i=t.x*e.y-e.x*t.y>0?1:-1,o=this.getLength(t),r=this.getLength(e),s=o*r,h=void 0,a=void 0;return 0===s?0:(h=t.x*e.x+t.y*e.y,a=h/s,a>1&&(a=1),a<-1&&(a=-1),Math.acos(a)*i*180/Math.PI)},getBasePoint:function(t){if(!t)return{x:0,y:0};var e=this.getOffset(t),n=e.left+t.getBoundingClientRect().width/2,i=e.top+t.getBoundingClientRect().width/2;return{x:Math.round(n),y:Math.round(i)}},extend:function(t,e){for(var i in e)e.hasOwnProperty(i)&&("object"!=n(e[i])||e[i]instanceof Node?t[i]=e[i]:("object"!==n(t[i])&&(t[i]={}),this.extend(t[i],e[i])));return t},getVector:function(t,e){return"object"!==(void 0===t?"undefined":n(t))||"object"!==(void 0===e?"undefined":n(e))?void console.error("getvector error!"):{x:Math.round(t.x-e.x),y:Math.round(t.y-e.y)}},getPoint:function(t,e){return t&&t.touches[e]?{x:Math.round(t.touches[e].pageX),y:Math.round(t.touches[e].pageY)}:void console.error("getPoint error!")},getOffset:function(t){t="string"==typeof t?document.querySelector(t):t;var e=t.getBoundingClientRect();return{left:e.left+document.body.scrollLeft,top:e.top+document.body.scrollTop,width:t.offsetWidth,height:t.offsetHeight}},matrixTo:function(t){var e=t.replace("matrix(","").replace(")","").split(","),n=e[0],i=e[1],o=i/n,r=180*Math.atan(o)/Math.PI,s=n/Math.cos(Math.PI/180*r);return{x:parseInt(e[4]),y:parseInt(e[5]),scale:s,rotate:r}},getUseName:function(t){var e=t.replace("start",""),n=-1!==e.indexOf("rotate")?"nd":"end";return e=e.replace(n,"")},domify:function(t){var e=document.implementation.createHTMLDocument();return e.body.innerHTML=t,e.body.children},getEl:function(t){if(!t)return void console.error("el error,there must be a el!");var e=void 0;if("string"==typeof t)e=document.querySelector(t);else{if(!(t instanceof Node))return void console.error("el error,there must be a el!");e=t}return e},data:function(t,e){return t=this.getEl(t),t.getAttribute("data-"+e)},include:function(t,e){return!!t.indexOf&&-1!==t.indexOf(e)},getPos:function(t){if(t){t=this.getEl(t);var e=void 0,n=window.getComputedStyle(t,null),i=n.transform||n.webkitTransform;return e=window.getComputedStyle&&"none"!==i?this.matrixTo(i):{x:0,y:0,scale:1,rotate:0},JSON.parse(t.getAttribute("data-mtouch-status"))||e}}},o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(){function e(n){t(this,e),this.handlers=[],this.el=n}return o(e,[{key:"add",value:function(t){return this.handlers.push(t),this}},{key:"del",value:function(t){var e=this;return t?this.handlers.forEach(function(n,i){n===t&&e.handlers.splice(i,1)}):this.handlers=[],this}},{key:"fire",value:function(){var t=this,e=arguments;if(this.handlers&&0!==!this.handlers.length)return this.handlers.forEach(function(n){"function"==typeof n&&n.apply(t.el,e)}),this}}]),e}(),s=function(){function t(t,e){var n=[],i=!0,o=!1,r=void 0;try{for(var s,h=t[Symbol.iterator]();!(i=(s=h.next()).done)&&(n.push(s.value),!e||n.length!==e);i=!0);}catch(t){o=!0,r=t}finally{try{!i&&h.return&&h.return()}finally{if(o)throw r}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),h=["touchstart","touchmove","touchend","drag","dragstart","dragend","pinch","pinchstart","pinchend","rotate","rotatestart","rotatend","singlePinchstart","singlePinch","singlePinchend","singleRotate","singleRotatestart","singleRotatend"],a=["touchstart","touchmove","touchend","touchcancel"];return e.prototype._driveBus=function(){var t=this;h.forEach(function(e){t[e]=new r(t.el)})},e.prototype._bind=function(){var t=this;a.forEach(function(e){var n="touchcancel"==e?"end":e.replace("touch","");t["_"+n+"_bind"]=t["_"+n].bind(t),t.el.addEventListener(e,t["_"+n+"_bind"],!1)})},e.prototype.destroy=function(){var t=this;a.forEach(function(e){var n="touchcancel"==e?"end":e.replace("touch","");t.el.removeEventListener(e,t["_"+n+"_bind"],!1)})},e.prototype._start=function(t){if(t.touches&&"touchstart"===t.type){if(this.fingers=t.touches.length,this.startPoint=i.getPoint(t,0),this.singleBasePoint=i.getBasePoint(this.operator),this.fingers>1)this.secondPoint=i.getPoint(t,1),this.vector1=i.getVector(this.secondPoint,this.startPoint),this.pinchStartLength=i.getLength(this.vector1);else if(this.use.singlePinch){var e=i.getVector(this.startPoint,this.singleBasePoint);this.singlePinchStartLength=i.getLength(e)}this.touchstart.fire({origin:t,eventType:"touchstart"})}},e.prototype._move=function(t){if(t.touches&&"touchmove"===t.type){var e=i.data(t.target,"singleButton"),n=t.touches.length,o=i.getPoint(t,0),r=void 0,s=void 0,h=void 0,a=void 0,c=void 0;if(n<this.fingers)return this.startPoint=o,void(this.fingers=n);if(!(n>1)||this.secondPoint&&this.vector1&&this.pinchStartLength||(this.secondPoint=i.getPoint(t,1),this.vector1=i.getVector(this.secondPoint,this.startPoint),this.pinchStartLength=i.getLength(this.vector1)),n>1){var u=i.getPoint(t,1),d=i.getVector(u,o);this.use.pinch&&(s=i.getLength(d),this._eventFire("pinch",{delta:{scale:s/this.pinchStartLength},origin:t}),this.pinchStartLength=s),this.use.rotate&&(this._eventFire("rotate",{delta:{rotate:i.getAngle(this.vector1,d)},origin:t}),this.vector1=d)}else this.use.singlePinch&&e&&(c=i.getVector(o,this.singleBasePoint),r=i.getLength(c),this._eventFire("singlePinch",{delta:{scale:r/this.singlePinchStartLength,deltaX:o.x-this.startPoint.x,deltaY:o.y-this.startPoint.y},origin:t}),this.singlePinchStartLength=r),this.use.singleRotate&&e&&(h=i.getVector(this.startPoint,this.singleBasePoint),a=i.getVector(o,this.singleBasePoint),this._eventFire("singleRotate",{delta:{rotate:i.getAngle(h,a)},origin:t}));this.use.drag&&(e||this._eventFire("drag",{delta:{deltaX:o.x-this.startPoint.x,deltaY:o.y-this.startPoint.y},origin:t})),this.startPoint=o,this.touchmove.fire({eventType:"touchmove",origin:t}),t.preventDefault()}},e.prototype._end=function(t){var e=this;(t.touches||"touchend"===t.type||"touchcancel"===t.type)&&(["pinch","drag","rotate","singleRotate","singlePinch"].forEach(function(n){e._eventEnd(n,{origin:t})}),this.touchend.fire({eventType:"touchend",origin:t}))},e.prototype._eventFire=function(t,e){var n=t+"ing",i=t+"start";this[n]?(e.eventType=t,this[t].fire(e)):(e.eventType=i,this[i].fire(e),this[n]=!0)},e.prototype._eventEnd=function(t,e){var n=t+"ing",i=void 0;i="rotate"==t||"singleRotate"==t?t+"nd":t+"end",this[n]&&(e.eventType=i,this[i].fire(e),this[n]=!1)},e.prototype._addButton=function(t){var e=i.domify("<div class=\"mtouch-singleButton\" data-singleButton='true' style='position:absolute;right:-15px;bottom: -15px;width:30px;height: 30px;background-size: 100% 100%;'></div>"),n=s(e,1),o=n[0],r=void 0;t.appendChild(o),t.setAttribute("data-mtouch-addButton",!0),getComputedStyle&&"static"===window.getComputedStyle(t,null).position&&(r=t.style||"",t.style=r+"position:relative")},e.prototype.switch=function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=void 0;if(!t)return void(this.operator=this.el);this.operator=n=i.getEl(t),!i.data(n,"mtouch-addButton")&&(this.use.singleRotate||this.use.singlePinch)&&e&&this._addButton(n)},e.prototype.on=function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},o=arguments[2];return i.include(t," ")?t.split(" ").forEach(function(t){e._on(t,n,o)}):this._on(t,n,o),this},e.prototype._on=function(t,e,n){this.use[i.getUseName(t)]=!0,this[t].add(e),this.switch(n)},e.prototype.off=function(t,e){this[t].del(e)},e});
//# sourceMappingURL=mtouch.min.js.map
